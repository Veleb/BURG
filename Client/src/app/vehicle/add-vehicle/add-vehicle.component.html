<form #form="ngForm" (ngSubmit)="onSubmit()" class="vehicle-form">

  <div class="form-group">
    <label for="vehicleName">Vehicle Name</label>
    <input type="text" id="vehicleName" name="vehicleName" 
           [(ngModel)]="vehicleData.vehicleName" required minlength="2" #name="ngModel">
    @if (name.invalid && (name.dirty || name.touched)) {
      <div class="validation-error">
        @if (name.errors?.['required']) {
          <div>Name is required</div>
        }
        @if (name.errors?.['minlength']) {
          <div>Minimum 2 characters required</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="vehicleModel">Vehicle Model</label>
    <input type="text" id="vehicleModel" name="vehicleModel" 
           [(ngModel)]="vehicleData.vehicleModel" required minlength="2" #model="ngModel">
    @if (model.invalid && (model.dirty || model.touched)) {
      <div class="validation-error">
        @if (model.errors?.['required']) {
          <div>Model is required</div>
        }
        @if (model.errors?.['minlength']) {
          <div>Minimum 2 characters required</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="vehicleYear">Vehicle Year</label>
    <input type="number" id="vehicleYear" name="vehicleYear" 
           [(ngModel)]="vehicleData.vehicleYear" required 
           min="1886" [max]="maxYear" #year="ngModel">
    @if (year.invalid && (year.dirty || year.touched)) {
      <div class="validation-error">
        @if (year.errors?.['required']) {
          <div>Year is required</div>
        }
        @if (year.errors?.['min'] || year.errors?.['max']) {
          <div>Must be between 1886 and {{maxYear}}</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="vehicleEngine">Vehicle Engine</label>
    <input type="text" id="vehicleEngine" name="vehicleEngine" 
           [(ngModel)]="vehicleData.vehicleEngine" required minlength="2" #engine="ngModel">
    @if (engine.invalid && (engine.dirty || engine.touched)) {
      <div class="validation-error">
        @if (engine.errors?.['required']) {
          <div>Engine is required</div>
        }
        @if (engine.errors?.['minlength']) {
          <div>Minimum 2 characters required</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="vehiclePower">Vehicle Power</label>
    <input type="text" id="vehiclePower" name="vehiclePower" 
           [(ngModel)]="vehicleData.vehiclePower" required 
           pattern="^\d+\s*[a-zA-Z]*$" #power="ngModel">
    @if (power.invalid && (power.dirty || power.touched)) {
      <div class="validation-error">
        @if (power.errors?.['required']) {
          <div>Power is required</div>
        }
        @if (power.errors?.['pattern']) {
          <div>Format: 100 HP or similar</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="identificationNumber">Vehicle VIN (Identification Number)</label>
    <input type="text" id="identificationNumber" name="identificationNumber" 
           [(ngModel)]="vehicleData.identificationNumber" required 
           minlength="17" maxlength="17" pattern="[A-HJ-NPR-Z0-9]{17}" 
           #idn="ngModel" (input)="vehicleData.identificationNumber = vehicleData.identificationNumber.toUpperCase()">
    @if (idn.invalid && (idn.dirty || idn.touched)) {
      <div class="validation-error">
        @if (idn.errors?.['required']) {
          <div>VIN is required</div>
        }
        @if (idn.errors?.['minlength'] || idn.errors?.['maxlength']) {
          <div>Must be exactly 17 characters</div>
        }
        @if (idn.errors?.['pattern']) {
          <div>Invalid VIN format (alphanumeric, no I/O/Q)</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="vehicleGVW">Vehicle GVW (Gross Vehicle Weight)</label>
    <input type="number" id="vehicleGVW" name="vehicleGVW" 
           [(ngModel)]="vehicleData.vehicleGvw" required min="0" #gvw="ngModel">
    @if (gvw.invalid && (gvw.dirty || gvw.touched)) {
      <div class="validation-error">
        @if (gvw.errors?.['required']) {
          <div>GVW is required</div>
        }
        @if (gvw.errors?.['min']) {
          <div>Must be ≥ 0</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="fuelTank">Vehicle Fuel Tank Capacity</label>
    <input type="number" id="fuelTank" name="fuelTank" 
           [(ngModel)]="vehicleData.vehicleFuelTank" required min="0" #fuelTank="ngModel">
    @if (fuelTank.invalid && (fuelTank.dirty || fuelTank.touched)) {
      <div class="validation-error">
        @if (fuelTank.errors?.['required']) {
          <div>Fuel tank capacity is required</div>
        }
        @if (fuelTank.errors?.['min']) {
          <div>Must be ≥ 0</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="tyres">Number of Tyres</label>
    <input type="number" id="tyres" name="tyres" 
           [(ngModel)]="vehicleData.vehicleTyres" required min="2" #tyres="ngModel">
    @if (tyres.invalid && (tyres.dirty || tyres.touched)) {
      <div class="validation-error">
        @if (tyres.errors?.['required']) {
          <div>Number of tyres is required</div>
        }
        @if (tyres.errors?.['min']) {
          <div>Minimum 2 tyres required</div>
        }
      </div>
    }
  </div>
  
  <div class="form-group">
    <label for="mileage">Vehicle Mileage</label>
    <input type="number" id="mileage" name="mileage" 
           [(ngModel)]="vehicleData.vehicleMileage" required min="0" #mileage="ngModel">
    @if (mileage.invalid && (mileage.dirty || mileage.touched)) {
      <div class="validation-error">
        @if (mileage.errors?.['required']) {
          <div>Mileage is required</div>
        }
        @if (mileage.errors?.['min']) {
          <div>Must be ≥ 0</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="chassis">Vehicle Chassis Type</label>
    <input type="text" id="chassis" name="chassis" 
           [(ngModel)]="vehicleData.vehicleChassisType" required minlength="2" #chassisType="ngModel">
    @if (chassisType.invalid && (chassisType.dirty || chassisType.touched)) {
      <div class="validation-error">
        @if (chassisType.errors?.['required']) {
          <div>Chassis type is required</div>
        }
        @if (chassisType.errors?.['minlength']) {
          <div>Minimum 2 characters required</div>
        }
      </div>
    }
  </div>

  <div class="form-group">
    <label for="capacity">Vehicle Capacity</label>
    <input type="number" id="capacity" name="capacity" 
           [(ngModel)]="vehicleData.vehicleCapacity" required min="0" #capacity="ngModel">
    @if (capacity.invalid && (capacity.dirty || capacity.touched)) {
      <div class="validation-error">
        @if (capacity.errors?.['required']) {
          <div>Capacity is required</div>
        }
        @if (capacity.errors?.['min']) {
          <div>Must be ≥ 0</div>
        }
      </div>
    }
  </div>

  <div class="form-group isPromotedCheckbox">
    <label class="promotedLabel" for="isPromoted">Is Promoted?</label>
    <input type="checkbox" id="isPromoted" name="isPromoted" class="promotedCheckbox"
           [(ngModel)]="vehicleData.isPromoted" #isPromoted="ngModel">
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="vehicleSize">Size</label>
      <select id="vehicleSize" name="vehicleSize" 
              [(ngModel)]="vehicleData.vehicleSize" required #size="ngModel">
        @for (size of sizes; track size) {
          <option [value]="size">{{size}}</option>
        }
      </select>
      @if (size.invalid && (size.dirty || size.touched)) {
        <div class="validation-error">Size is required</div>
      }
    </div>

    <div class="form-group">
      <label for="vehicleCategory">Category</label>
      <select id="vehicleCategory" name="vehicleCategory" 
              [(ngModel)]="vehicleData.vehicleCategory" required #category="ngModel">
        @for (cat of categories; track cat) {
          <option [value]="cat">{{cat}}</option>
        }
      </select>
      @if (category.invalid && (category.dirty || category.touched)) {
        <div class="validation-error">Category is required</div>
      }
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="vehiclePricePerDay">Price/Day</label>
      <input type="number" id="vehiclePricePerDay" name="vehiclePricePerDay" 
             [(ngModel)]="vehicleData.vehiclePricePerDay" required min="0" #priceDay="ngModel">
      @if (priceDay.invalid && (priceDay.dirty || priceDay.touched)) {
        <div class="validation-error">
          @if (priceDay.errors?.['required']) {
            <div>Required</div>
          }
          @if (priceDay.errors?.['min']) {
            <div>Must be ≥ 0</div>
          }
        </div>
      }
    </div>

    <div class="form-group">
      <label for="vehiclePricePerKm">Price/KM</label>
      <input type="number" id="vehiclePricePerKm" name="vehiclePricePerKm" 
             [(ngModel)]="vehicleData.vehiclePricePerKm" required min="0" #priceKm="ngModel">
      @if (priceKm.invalid && (priceKm.dirty || priceKm.touched)) {
        <div class="validation-error">
          @if (priceKm.errors?.['required']) {
            <div>Required</div>
          }
          @if (priceKm.errors?.['min']) {
            <div>Must be ≥ 0</div>
          }
        </div>
      }
    </div>
  </div>

  <div class="form-group">
    <label for="vehicleImages">Vehicle Images</label>
    <input type="file" id="vehicleImages" (change)="onImagesSelected($event)" 
           multiple accept="image/*" required>
    @if (formSubmitted && (!selectedImages || selectedImages.length === 0)) {
      <div class="validation-error">At least one image is required</div>
    }
    <ul>
      @for (file of selectedImages; track $index) {
        <li>{{ file.name }}</li>
      }
    </ul>
  </div>

  <div class="form-group">
    <label for="vehicleRegistration">Vehicle Registration</label>
    <input type="file" id="vehicleRegistration" (change)="onRegistrationSelected($event)" 
           multiple accept="image/*" required>
    @if (formSubmitted && (!selectedRegistrations || selectedRegistrations.length === 0)) {
      <div class="validation-error">Registration document is required</div>
    }
    <ul>
      @for (file of selectedRegistrations; track $index) {
        <li>{{ file.name }}</li>
      }
    </ul>
  </div>

  <button type="submit" [disabled]="isSubmitting" class="submit-btn">
    @if (isSubmitting) {
      Submitting...
    } @else {
      Create Vehicle
    }
  </button>
</form>